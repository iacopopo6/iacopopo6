---
title: 'Cyclistic bike-share (case study)'
author: "Iacopo A. Pedde"
date: "2023-08-22"
output: 
  html_document: default
  word_document: default
  pdf_document: default
---


# Introduction

I'm working as junior data analyst in the marketing analyst team at Cyclistic, a bike-share company in Chicago. The director
of marketing believes the companyâ€™s future success depends on maximizing the number of annual memberships. Therefore,
your team wants to understand how casual riders and annual members use Cyclistic bikes differently. From these insights,
your team will design a new marketing strategy to convert casual riders into annual members. But first, Cyclistic executives
must approve your recommendations, so they must be backed up with compelling data insights and professional data
visualizations.

#### Characters and teams:

Cyclistic -> Company name

Lily Moreno -> Director

Cyclistic marketing analytics team

Cyclistic executive team

#### Business problem/Ask

* How do annual members and casual riders use Cyclistic bikes differently?

* Why would casual riders buy Cyclistic annual memberships?

* How can Cyclistic use digital media to influence casual riders to become members?

#### Task to complete

1. A clear statement of the business task
2. A description of all data sources used
3. Documentation of any cleaning or manipulation of data
4. A summary of your analysis
5. Supporting visualizations and key findings
6. Your top three recommendations based on your analysis


#### Prepare the data

The data files are in CSV form provided by Google at this link [link](https://divvy-tripdata.s3.amazonaws.com/index.html). 
The rights over the data are owned by the company Cyclistic and it follows the ROCCC acronym standards meaning in order that it is: Reliable, Original, Comprehensive, Current and Cited.
The time period is from august 2022 to july 2023.

For the analysis, I will be using R for it's easy statistical analysis tools and data visualizations.

# Process and Analyse

Setting up the environment

Note: Installing packages and uploading datasets.

```{r Packages, message=FALSE, warning=FALSE}
#install.packages("tidyverse")
library(tidyverse)
#install.packages("skimr")
library(skimr)
#install.packages("lubridate")
library(lubridate)
#install.packages('ggplot2')
library(ggplot2)
```

##### COLLECT DATA

Importing and renaming datasets


```{r message=FALSE, warning=FALSE, results="hide"}
aug <- read_csv("~/Desktop/Divvy_Trips/Divvy_Trips_new/202208-divvy-tripdata.csv",col_names = TRUE)
sep <- read_csv("~/Desktop/Divvy_Trips/Divvy_Trips_new/202209-divvy-publictripdata.csv",col_names = TRUE)
oct <- read_csv("~/Desktop/Divvy_Trips/Divvy_Trips_new/202210-divvy-tripdata.csv",col_names = TRUE)
nov <- read_csv("~/Desktop/Divvy_Trips/Divvy_Trips_new/202211-divvy-tripdata.csv",col_names = TRUE)
dec <- read_csv("~/Desktop/Divvy_Trips/Divvy_Trips_new/202212-divvy-tripdata.csv",col_names = TRUE)
jan <- read_csv("~/Desktop/Divvy_Trips/Divvy_Trips_new/202301-divvy-tripdata.csv",col_names = TRUE)
feb <- read_csv("~/Desktop/Divvy_Trips/Divvy_Trips_new/202302-divvy-tripdata.csv",col_names = TRUE)
mar <- read_csv("~/Desktop/Divvy_Trips/Divvy_Trips_new/202303-divvy-tripdata.csv",col_names = TRUE)
apr <- read_csv("~/Desktop/Divvy_Trips/Divvy_Trips_new/202304-divvy-tripdata.csv",col_names = TRUE)
may <- read_csv("~/Desktop/Divvy_Trips/Divvy_Trips_new/202305-divvy-tripdata.csv",col_names = TRUE)
jun <- read_csv("~/Desktop/Divvy_Trips/Divvy_Trips_new/202306-divvy-tripdata.csv",col_names = TRUE)
jul <- read_csv("~/Desktop/Divvy_Trips/Divvy_Trips_new/202307-divvy-tripdata.csv",col_names = TRUE)
```

##### COMBINE DATAFRAME INTO A SINGLE FILE


Note: Bind data frames together into one table 
```{r bind}
all_trips <- rbind(aug,sep,oct,nov,dec,jan,feb,mar,apr,may,jun,jul)
```

Once combined inspect the table data types.

```{r inspect1}
str(all_trips)
```

Remove columns that are not needed for our analysis: lat, long

```{r remove column}
all_trips <- all_trips %>% 
  select(-c(start_lat, start_lng, end_lat, end_lng))
```

Inspect the results

```{r}
colnames(all_trips)
```

##### CLEAN DATA AND PREPARE FOR ANALYSIS

Inspect the new created table

```{r results='hide'}
colnames(all_trips) #column names
dim(all_trips) # check the dimensions
head(all_trips) # first six rows
tail(all_trips) # last six rows
str(all_trips) # check data types
summary(all_trips) # statistical summary
```

##### Notes after the inspection:

* 1 We want to check member_casual column.
* 2 We want to add columns that list the date, month, day, and year of each ride.
* 3 We will create a new column that calculate the ride length in seconds to our new table.
* 4 We want to make sure that the new column "ride_length" doesn't have any negative values       and the table doesn't have any duplicates.


1 Checking number of riders as casual and member

```{r reassign member_casual labels}
table(all_trips$member_casual)
```




2 Adding lists: date, day, year, day of the week of each ride

```{r add date, month, day, year, day of week}
all_trips$date <- as.Date(all_trips$started_at) #The default format is yyyy-mm-dd
all_trips$month <- format(as.Date(all_trips$date), "%m")
all_trips$day <- format(as.Date(all_trips$date), "%d")
all_trips$year <- format(as.Date(all_trips$date), "%Y")
all_trips$day_of_week <- format(as.Date(all_trips$date), "%A")

```

After adding the date format for each ride we want to create a new column that calculate the ride length in minutes to our new table.

3 Add the ride_length column (in seconds) as numeric and inspect the table 

```{r add ride_length, results='hide'}
all_trips$ride_length <- as.numeric(difftime(all_trips$ended_at,all_trips$started_at))
str(all_trips)
```
4 Removing bad data 
```{r results ='hide'}
# Cleaning under 0 values and duplicates
all_trips_v2 <- all_trips[!all_trips$ride_length <0 | duplicated(all_trips$ride_id), ]
str(all_trips_v2)
```


##### CONDUCT DESCRIPTIVE ANALYSIS

Find statistics of the ride length in seconds 
Summary of average, median, min and max of ride length in seconds


```{r descriptive ride_length analysis}
# Descriptive analysis on ride_length 
mean(all_trips_v2$ride_length) #straight average 
median(all_trips_v2$ride_length) #midpoint number in the ascending array of ride lengths
max(all_trips_v2$ride_length) #longest ride
min(all_trips_v2$ride_length) #shortest ride
```
Summary of ride length this time in minutes for a better understanding
```{r summary ride_legth}
summary(all_trips_v2$ride_length)/60
```
We find out that on average each ride are approx 20 minutes now we want to compare member and casual users.
```{r}
# Compare members and casual users
aggregate(all_trips_v2$ride_length/60 ~ all_trips_v2$member_casual, FUN = mean)
aggregate(all_trips_v2$ride_length/60 ~ all_trips_v2$member_casual, FUN = median)

```
Looking at casual riders versus members, we see that the average casual ride is approx about 25 minutes compared to members average ride of approx 15 minutes. The median rides are 11 and 8 respectively

Now we want to calculate the average ride time in minutes by each day for members vs casual users

```{r results='hide'}
all_trips_v2$day_of_week <- ordered(all_trips_v2$day_of_week, levels=c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))
aggregate(all_trips_v2$ride_length/60 ~ all_trips_v2$member_casual + all_trips_v2$day_of_week, FUN = mean)
```
Seems like casual riders tend to cycle more at weekends

In the code chunk below we want to analyze ridership data sorted by type and weekday

```{r warning=TRUE}
all_trips_v2 %>% 
  mutate(weekday = wday(started_at, label = TRUE)) %>% #creates weekday field using wday()
  group_by(member_casual, weekday) %>%  #groups by usertype and weekday
  summarise(number_of_rides = n()  # calculates the average duration
  ,average_duration = mean(ride_length/60)) %>% 		
  arrange(member_casual, weekday) # sort by weekday
```



#### Identify trends and relationships.

What story does the data tell us?

* Casual riders rides more and longer on weekends 
* Members tend to use the service more mid-week probably to go to work or school in general

# Share

#### Table 1: Number of rides by rider type

```{r}
all_trips_v2 %>% 
  mutate(weekday = wday(started_at, label = TRUE)) %>% 
  group_by(member_casual, weekday) %>% 
  summarise(number_of_rides = n()
            ,average_duration = mean(ride_length)) %>% 
  arrange(member_casual, weekday)  %>% 
  ggplot(aes(x = weekday, y = number_of_rides, fill = member_casual)) +
  geom_col(position = "dodge") + 
  labs(title = "Table 1: Number of Rides by Day and Rider Type") + 
  ylab("Number of Rides (1e+05 = 100,000)") + 
  xlab("Day of Week")
```

#### Table 2: Average Ride Duration by Day and Rider Type

```{r}
all_trips_v2 %>% 
  mutate(weekday = wday(started_at, label = TRUE)) %>% 
  group_by(member_casual, weekday) %>% 
  summarise(number_of_rides = n()
            ,average_duration = mean(ride_length/60)) %>% 
  arrange(member_casual, weekday)  %>% 
  ggplot(aes(x = weekday, y = average_duration, fill = member_casual)) +
  geom_col(position = "dodge") + 
  labs(title = "Table 2: Average Ride Duration by Day and Rider Type") + 
  ylab("Average Duration (minutes)") + 
  xlab("Day of Week")
```


#### Table 3: Rideable type by rider type

```{r}

all_trips_v2 %>%
    group_by(rideable_type) %>% 
    summarise(count = length(ride_id),
          '%' = (length(ride_id) / nrow(all_trips_v2)) * 100,
          'members_p' = (sum(member_casual == "member") / length(ride_id)) * 100,
          'casual_p' = (sum(member_casual == "casual") / length(ride_id)) * 100,
          'member_casual_perc_difer' = members_p - casual_p)
ggplot(all_trips_v2, aes(rideable_type, fill=member_casual)) +
    labs(x="Rideable type", title="Chart 07 - Distribution of types of bikes") +
    geom_bar()
```



#### Key findings

* Members are more likely to use the service in the middle of the week while casual use it on   weekends.
* Casual users are using bikes for longer leisurely rides.
* On average each trip last approx 20 minutes.
* Saturdays and Sundays are the busiest days for both casual and members.
* Both casual and member prefer using electrical bikes over normal.

#### Recommendations/Act

Consider offering an off peak membership tier that offers unlimited rides during the weekends.

Social media platforms can be a powerful tool to influence Cyclistic casual riders to become members.

Implementing more electrical bikes or scooter will boost Cyclistic economy since both casual and member prefer it to normal bycicle.
